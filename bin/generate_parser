#!/usr/bin/env python
# -*- mode: python -*-

import sys
from ometa.runtime import ParseError
from ometa.grammar import OMeta
from ometa.builder import writePython

if len(sys.argv) != 3:
 print "Usage: generate_grammar grammar-filename python-filename"
 sys.exit(1)

grammarFile = open(sys.argv[1], 'r')
pythonFile =  open(sys.argv[2], 'w')
s = grammarFile.read()
g = OMeta(s)
try:
    tree = g.parseGrammar("Parser")
except ParseError, e:
    print e.formatErrorTwine(g.input.data)
    raise
source = writePython(tree)
pythonFile.write("from ometa.runtime import OMetaGrammarBase as GrammarBase\n")
pythonFile.write(source)
